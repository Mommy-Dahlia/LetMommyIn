<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Device {{ device.username }}</title>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  </head>
  <body>
    <p><a href="/">‚Üê Back</a></p>

    <h1>Device: {{ device.username }}</h1>

    <ul>
      <li><b>Status:</b> {% if device.online %}Online{% else %}Offline{% endif %}</li>
      <li><b>Device name:</b> {{ device.device_name }}</li>
      <li><b>Version:</b> {{ device.version }}</li>
      <li><b>Device ID:</b> <code>{{ device.device_id }}</code></li>
      <li><b>Last seen:</b> {{ device.last_seen }}</li>
    </ul>

    <h2>Send Message</h2>

    <form
      hx-post="/device/{{ device.device_id }}/message"
      hx-target="#send-result"
      hx-swap="innerHTML"
    >
      <p>
        <label>Title<br />
          <input name="title" required />
        </label>
      </p>

      <p>
        <label>Body<br />
          <textarea name="body" rows="4" required></textarea>
        </label>
      </p>

      <p>
        <label>Level<br />
          <select name="level">
            <option value="info" selected>info</option>
            <option value="warning">warning</option>
            <option value="error">error</option>
          </select>
        </label>
      </p>

      <p>
        <label>Lifespan (seconds)<br />
          <input
            name="lifespan_s"
            type="number"
            min="0"
            placeholder="(default: 10)"
          />
        </label>
      </p>

      <button type="submit">Send</button>
    </form>

    <form
      hx-post="/device/{{ device.device_id }}/open_url"
      hx-target="#send-result"
      hx-swap="innerHTML"
    >
      <p>
        <label>Open URL<br />
          <input name="url" required placeholder="https://example.com" />
        </label>
      </p>

      <button type="submit">Open</button>
    </form>

    <form
      hx-post="/device/{{ device.device_id }}/image_popup"
      hx-target="#send-result"
      hx-swap="innerHTML"
    >
      <p>
        <label>Image URL<br />
          <input name="url" required placeholder="https://example.com/image.png" />
        </label>
      </p>

      <button type="submit">Show Image</button>
    </form>

    <form hx-post="/device/{{ device.device_id }}/audio_play" hx-target="#send-result" hx-swap="innerHTML">
      <div>
        <label>Audio URL</label><br/>
        <input type="text" name="url" style="width: 100%;" placeholder="https://.../loop.mp3" />
      </div>

      <div style="display:flex; gap: 1rem; margin-top: .5rem;">
        <div>
          <label>Volume (0-1)</label><br/>
          <input type="text" name="volume" value="0.8" />
        </div>

        <div>
          <label>Loop</label><br/>
          <select name="loop">
            <option value="true" selected>true</option>
            <option value="false">false</option>
          </select>
        </div>

        <div>
          <label>Duration (s)</label><br/>
          <input type="text" name="duration_s" placeholder="blank = infinite" />
        </div>
      </div>

      <button type="submit" style="margin-top: .5rem;">Play</button>
    </form>

    <form hx-post="/device/{{ device.device_id }}/audio_stop" hx-target="#send-result" hx-swap="innerHTML" style="margin-top:.5rem;">
      <button type="submit">Stop</button>
    </form>

    <form hx-post="/device/{{ device.device_id }}/subliminal_start" hx-target="#send-result" hx-swap="innerHTML">
      <div>
        <label>Messages (one per line)</label><br/>
        <textarea name="messages" rows="6" style="width: 100%;"></textarea>
      </div>

      <div style="display:flex; gap: 1rem; margin-top: .5rem;">
        <div>
          <label>Duration (s)</label><br/>
          <input type="text" name="duration_s" value="10" />
        </div>
        <div>
          <label>Interval (ms)</label><br/>
          <input type="text" name="interval_ms" value="50" />
        </div>
        <div>
          <label>Flash (ms)</label><br/>
          <input type="text" name="flash_ms" value="16" />
        </div>
        <div>
          <label>Font (pt)</label><br/>
          <input type="text" name="font_pt" value="18" />
        </div>
      </div>

      <button type="submit" style="margin-top: .5rem;">Start</button>
    </form>

    <form hx-post="/device/{{ device.device_id }}/subliminal_stop" hx-target="#send-result" hx-swap="innerHTML" style="margin-top:.5rem;">
      <button type="submit">Stop</button>
    </form>

    <form
      hx-post="/device/{{ device.device_id }}/write_for_me"
      hx-target="#send-result"
      hx-swap="innerHTML"
    >
      <div>
        <label>Write text</label><br/>
        <input type="text" name="text" style="width: 100%;" />
      </div>

      <div style="margin-top: .5rem;">
        <label>Repetitions</label><br/>
        <input type="text" name="reps" value="5" />
      </div>

      <button type="submit" style="margin-top: .5rem;">
        Send Write-For-Me
      </button>
    </form>

    <form
      hx-post="/device/{{ device.device_id }}/session/start"
      hx-target="#send-result"
      hx-swap="innerHTML"
      enctype="multipart/form-data"
    >
      <p>
        <label>Session file (.json)<br />
          <input name="session_file" type="file" accept=".json,application/json" required />
        </label>
      </p>

      <button type="submit">Start Session</button>
    </form>

    <form
      hx-post="/device/{{ device.device_id }}/gif_overlay"
      hx-target="#send-result"
      hx-swap="innerHTML"
    >
      <div>
        <label>GIF Overlay URL</label><br/>
        <input type="text" name="url" style="width: 100%;" placeholder="https://.../overlay.gif" />
      </div>

      <div style="display:flex; gap: 1rem; margin-top: .5rem;">
        <div>
          <label>Opacity (0-1)</label><br/>
          <input type="text" name="opacity" value="0.4" />
        </div>
        <div>
          <label>Screen (-1 = all)</label><br/>
          <input type="text" name="screen" value="-1" />
        </div>
      </div>

      <button type="submit" style="margin-top: .5rem;">Start Overlay</button>
    </form>

    <form
      hx-post="/device/{{ device.device_id }}/gif_overlay/stop"
      hx-target="#send-result"
      hx-swap="innerHTML"
      style="margin-top: .5rem;"
    >
      <button type="submit">Stop Overlay</button>
    </form>

    <div id="send-result" style="margin-top: 10px;"></div>


    <h2>Recent Logs</h2>
    <table border="1" cellpadding="6" cellspacing="0">
      <thead>
        <tr>
          <th>ts</th>
          <th>event</th>
          <th>command_id</th>
          <th>detail</th>
        </tr>
      </thead>
      <tbody>
        {% for l in logs %}
        <tr>
          <td>{{ l.ts }}</td>
          <td>{{ l.event }}</td>
          <td><code>{{ l.command_id }}</code></td>
          <td>{{ l.detail }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </body>
</html>
